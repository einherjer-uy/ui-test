<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!--see http://getbootstrap.com/css/-->
    <title>Twitter - Corporate Events Tracking System</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" media="screen">    
    <link rel="stylesheet" href="../public/css/tt.css" media="screen">
    <link rel="stylesheet" href="../public/css/bootstrap-datetimepicker.min.css" media="screen" >
    <link rel="stylesheet" href="../public/css/bootstrap-glyphicons.css" media="screen" >
    <!--<link href="../public/lib/backbone-upload-manager-master/css/backbone.upload-manager.css" rel="stylesheet">-->
	<link rel="stylesheet" href="../public/lib/jquery-file-upload/css/jquery.fileupload-ui.css" media="screen">
</head>
<body class="tt-body">

	<div class="navbar navbar-inverse navbar-static-top tt-navbar">
		<div class="navbar-inner">
			<div class="container">
				<a class="brand" href="http://www.twitter.com">
					<span class="tt-icon tt-bird"></span>
				</a>

				<ul class="nav pull-right">	
					<li><a id="loggedUser"></a></li>
					<li class="divider-vertical"></li>							
					<li><a id="logoutLink" class="tt-inverse-text" href="/logout">Logout</a></li>
				</ul>				
			</div>
		</div>
	</div>

	<section id="ttApp" class="container well">
		<header id="header">
			<h2>Tickets</h2>
			<hr />
		</header>
		
		<section id="progress">			
			<div class="progress progress-striped active" style="width: 25%">
				<div id="ticket-progress" class="bar" role="progressbar" style="width: 100%">
					<div class="bar" style="width: 100%"></div>
				</div>
			</div>
		</section>

		<section id="main">
			<div class="alert-container" id="dashboardMessages"></div>
			<table id="ticketTable" class="table table-striped table-hover" style="display:none;">
				<thead>
					<tr>
						<th>Id</th>
						<th>Description</th>
						<th>Type</th>
						<th>Priority</th>
						<th>Due date</th>
						<th colspan="4">Status</th>					
					</tr>
				</thead>
			</table>
			<div id="tableFooter"></div>
			<a id="addButton" class="btn btn-primary btn-small pull-right">Create new ticket</a>
			<!-- Add/Edit ticket modal -->
			<div class="modal fade" id="addEditModal"></div>
		</section>
		
		<footer id="ttApp-footer" class="row-fluid">
			<hr />
			<p class="span12 text-center"><small>Â© 1998 GSM. All rights reserved.</small></p>
		</footer>
	</section>


	<!--Template for the tickets table-->
	<script type="text/template" id="item-template">
        <td>{{ number }}</td>
        <td>{{ description }}</td>
        <td>{{ type }}</td>
        <td>{{ priority }}</td>
        <td>{{ due }}</td>
        <td>{{ status }}</td>
        <td>
        	<div class="actions"></div>
		</td>
	</script>

	<script type="text/template" id="actionsTemplate">
		<span class="viewSpan"><a href="#" class="viewAction glyphicon glyphicon-search tt-action"></a></span>
        <span class="editSpan"><a href="#" class="editAction glyphicon glyphicon-pencil tt-action"></a></span>
		<span class="cancelSpan"><a href="#" class="cancelAction glyphicon glyphicon-remove tt-action"></a></span>
		<span class="rejectSpan"><a href="#" class="rejectAction glyphicon glyphicon-thumbs-down tt-action"></a></span>
		<span class="approveSpan"><a href="#" class="approveAction glyphicon glyphicon-thumbs-up tt-action"></a></span>
		<span class="doneSpan"><a href="#" class="doneAction glyphicon glyphicon-ok tt-action"></a></span>
	</script>

	<script type="text/template" id="footer-template">
		<div><!--
			{{ test }}
			-->
		</div>
	</script>

    <script type="text/template" id="modal-template">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title">{{modalTitle || "Add / Edit Ticket"}}</h4>
			</div>
			<div class="modal-body" id="ticket-modal-body">
			
				<form id="ticket-form" class="form-horizontal" >

					<div class="alert-container" id="ticket-alert-container"></div>

					<div class="control-group" >
				    	<label class="control-label hidden-phone" for="type" title="This field is mandatory">Type<font color="red">*</font></label>				    	
				    	<div class="controls">
							<select id="type" placeholder="Type" value={{type}}></select>
				    	</div>						    		    	
				  	</div>	

					<div class="control-group" >
				  		<label class="control-label hidden-phone" for="priority" title="This field is mandatory">Priority<font color="red">*</font></label>
				    	<div class="controls">
							<select id="priority" placeholder="Priority" value={{priority}}></select>
				    	</div>
				    </div>				  	

					<div class="control-group">
						<label class="control-label hidden-phone" for="due">Due Date</label>
						<div class="controls">
							<div id="duedate-datetimepicker" class="input-append date">
								<input type="text" date-format="dd/MM/yyyy-hh:mm" id="due" placeholder="Due Date" value={{due == null ? "" : due}}></input>
								<span class="add-on"><i data-time-icon="icon-time" data-date-icon="icon-calendar"></i></span>
							</div>
						</div>					
					</div>

					<div class="control-group">
				    	<label class="control-label hidden-phone" for="description" title="This field is mandatory">Description<font color="red">*</font></label>
				    	<div class="controls">
							<textarea id="description" class="input-xlarge" rows="6" placeholder="Description">{{description}}</textarea>
							<div align="center"><small id="descriptionCharNum"></small></div>
							<span class="help-block">The description given will be used by the executors so it is fundamental to be as detailed as possible</span>
				    	</div>
				  	</div>

					<div id="fileUploadDiv" class="control-group">
				    	<label class="control-label hidden-phone" for="fileupload">Attachments</label>
				    	<div class="controls">
							<div>
				 				<span class="btn btn-success fileinput-button">
				                    <i class="glyphicon glyphicon-plus"></i>
				                    <span>Add files...</span>
				                    <input id="fileupload" type="file" name="files[]" multiple>
				                </span>
				                <div id="progress" class="progress progress-striped active" style="display:none; margin-top:7px;">
				                    <div class="bar" style="width:0%;"></div>
				                </div>
							    <table id="uploadedFiles" style="width:100%; margin: 5px, 0;"></table>
							</div>
				    	</div>
				  	</div>

					<!--<div id="fileUpload" class="control-group"></div>-->

					<div id="commentDiv" class="control-group"> 
						<!-- only for approvers changing the priority of a ticket trough this form -->
				    	<label class="control-label hidden-phone" for="comment">Comment</label>
				    	<div class="controls">
							<textarea id="comment" class="input-xlarge" rows="4" placeholder="Comment"></textarea>
				    	</div>
				  	</div>

	   			 </form>		
			</div>
			<div class="modal-footer">
				<div class="actions form-group pull-left text-left"></div>
				<button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
				<button type="button" id="saveButton" class="btn btn-primary">Save changes</button>
			</div>
		</div>
	</script>

	<script type="text/template" id="attachmentRowTemplate">
    	<td><a href='tt/tickets/TT-3/attachment/{{file.id}}' title='{{file.fileName}}'>{{file.fileName}}</a></td>
		<td class='white-space:nowrap'>{{file.fileSize}}</td>
        <td><a href='#' class='deleteAttach btn btn-danger glyphicon glyphicon-trash'></a></td>
	</script>

	<script type="text/template" id="attachmentsTemplateOLD">
		<% _.each(attachments, function(file) { %>
			<tr>
	        	<td><a href='tt/tickets/{{ticketNumber}}/attachment/{{file.id}}' title='{{file.fileName}}'>{{file.fileName}}</a></td>
				<td class='white-space:nowrap'>{{file.fileSize}}</td>
	            <td><a href='#' class='btn btn-danger glyphicon glyphicon-trash'></a></td>
	        </tr>
		<% }); %>
	</script>

	<script type="text/template" id="commentConfirmationTemplate">
		<div style="width: 250px;">
			<label>{{ mandatoryComment ? "Please provide a comment and confirm" : "Enter an optional comment and confirm" }}</label>
			<textarea class="form-control" rows="4" placeholder="Comment" autofocus></textarea>
			<div style="text-align: right;">
				<button type="button" class="confirmCancelButton btn btn-link btn-small">Cancel</button>
				<button type="button" class="confirmOkButton btn btn-primary btn-small">OK</button>
			</div>
		</div>
	</script>

	<script type="text/template" id="yesNoConfirmationTemplate">
		<div style="width: 200px;">
			<div style="text-align: center;">
				<label>Are you sure?</label>
			</div>
			<div style="text-align: right;">
				<button type="button" class="confirmCancelButton btn btn-link btn-small">Cancel</button>
				<button type="button" class="confirmOkButton btn btn-primary btn-small">OK</button>
			</div>
		</div>
	</script>

<!--
<form id="fileupload" action="tt/tickets/TT-2/attachment" method="POST" enctype="multipart/form-data">
         The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload --
        <div class="row fileupload-buttonbar">
            <div class="col-lg-7">
                <!-- The fileinput-button span is used to style the file input field as button --
                <span class="btn btn-success fileinput-button">
                    <i class="glyphicon glyphicon-plus"></i>
                    <span>Add files...</span>
                    <input type="file" name="files[]" multiple>
                </span>
                <button type="submit" class="btn btn-primary start">
                    <i class="glyphicon glyphicon-upload"></i>
                    <span>Start upload</span>
                </button>
                <button type="reset" class="btn btn-warning cancel">
                    <i class="glyphicon glyphicon-ban-circle"></i>
                    <span>Cancel upload</span>
                </button>
                <button type="button" class="btn btn-danger delete">
                    <i class="glyphicon glyphicon-trash"></i>
                    <span>Delete</span>
                </button>
                <input type="checkbox" class="toggle">
                <!-- The loading indicator is shown during file processing --
                <span class="fileupload-loading"></span>
            </div>
            <!-- The global progress information --
            <div class="col-lg-5 fileupload-progress fade">
                <!-- The global progress bar --
                <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                    <div class="progress-bar progress-bar-success" style="width:0%;"></div>
                </div>
                <!-- The extended global progress information --
                <div class="progress-extended">&nbsp;</div>
            </div>
        </div>
        <!-- The table listing the files available for upload/download --
        <table role="presentation" class="table table-striped"><tbody class="files"></tbody></table>
    </form>-->

<!-- The template to display files available for upload -->
<script id="template-upload" type="text/x-tmpl">
{% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-upload fade">
        <td>
            <span class="preview"></span>
        </td>
        <td>
            <p class="name">{%=file.name%}</p>
            {% if (file.error) { %}
                <div><span class="label label-important">Error</span> {%=file.error%}</div>
            {% } %}
        </td>
        <td>
            <p class="size">{%=o.formatFileSize(file.size)%}</p>
            {% if (!o.files.error) { %}
                <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div class="progress-bar progress-bar-success" style="width:0%;"></div></div>
            {% } %}
        </td>
        <td>
            {% if (!o.files.error && !i && !o.options.autoUpload) { %}
                <button class="btn btn-primary start">
                    <i class="glyphicon glyphicon-upload"></i>
                    <span>Start</span>
                </button>
            {% } %}
            {% if (!i) { %}
                <button class="btn btn-warning cancel">
                    <i class="glyphicon glyphicon-ban-circle"></i>
                    <span>Cancel</span>
                </button>
            {% } %}
        </td>
    </tr>
{% } %}
</script>
<!-- The template to display files available for download -->
<script id="template-download" type="text/x-tmpl">
{% for (var i=0, file; file=o.files[i]; i++) { %}
    <tr class="template-download fade">
        <td>
            <span class="preview">
                {% if (file.thumbnailUrl) { %}
                    <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" data-gallery><img src="{%=file.thumbnailUrl%}"></a>
                {% } %}
            </span>
        </td>
        <td>
            <p class="name">
                <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" {%=file.thumbnailUrl?'data-gallery':''%}>{%=file.name%}</a>
            </p>
            {% if (file.error) { %}
                <div><span class="label label-important">Error</span> {%=file.error%}</div>
            {% } %}
        </td>
        <td>
            <span class="size">{%=o.formatFileSize(file.size)%}</span>
        </td>
        <td>
            <button class="btn btn-danger delete" data-type="{%=file.deleteType%}" data-url="{%=file.deleteUrl%}"{% if (file.deleteWithCredentials) { %} data-xhr-fields='{"withCredentials":true}'{% } %}>
                <i class="glyphicon glyphicon-trash"></i>
                <span>Delete</span>
            </button>
            <input type="checkbox" name="delete" value="1" class="toggle">
        </td>
    </tr>
{% } %}
</script>

	<!-- jQuery -->
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

	<!-- File Upload -->	
	<script src="../public/lib/jquery/jquery.ui.widget.js"></script>
	<script src="../public/lib/jquery/jquery.iframe-transport.js"></script>
	<script src="../public/lib/jquery/jquery.fileupload.js"></script>

	<!--<script src="../public/lib/jquery-file-upload/js/jquery.fileupload-ui.js"></script>-->
<!-- The Templates plugin is included to render the upload/download listings 
<script src="http://blueimp.github.io/JavaScript-Templates/js/tmpl.min.js"></script>-->
<!-- The File Upload processing plugin 
<script src="../public/lib/jquery-file-upload/js/jquery.fileupload-process.js"></script>-->
<!-- The File Upload user interface plugin 
<script src="../public/lib/jquery-file-upload/js/jquery.fileupload-ui.js"></script>-->
<!-- The main application script 
<script src="../public/lib/jquery-file-upload/js/main.js"></script>-->

	<!-- Date-Time Picker -->
	<script src="../public/lib/bootstrap/bootstrap-datetimepicker.min.js"></script>    

    <!-- Backbone -->
	<script src="http://documentcloud.github.com/underscore/underscore-min.js"></script>
	<script>
		_.templateSettings = { 
			evaluate    : /<%([\s\S]+?)%>/g,
			interpolate : /\{\{(.+?)\}\}/g, //use {{ }} instead of <%= %> in underscore templates
		    escape      : /<%-([\s\S]+?)%>/g	
		 };
	</script>
	<script src="http://documentcloud.github.com/backbone/backbone-min.js"></script>
	
	<!--<script type="text/javascript" src="../public/lib/backbone/backbone.defered-view-loader.js"></script>-->
	<!-- Upload Manager script 
	<script type="text/javascript" src="../public/lib/backbone-upload-manager-master/js/backbone.upload-manager.js"></script>-->
	
	<!-- Bootstrap -->
	<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>

	<!-- Our app -->
	<script src="../public/js/models/ticket.js"></script>
	<script src="../public/js/collections/tickets.js"></script>
	<script src="../public/js/views/ticket.js"></script>
	<script src="../public/js/views/popover.js"></script>
	<script src="../public/js/views/actions.js"></script>
	<script src="../public/js/views/ticketRow.js"></script>
	<script src="../public/js/views/app.js"></script>
	<script src="../public/js/routers/router.js"></script>
	<script src="../public/js/utils/util.js"></script>
	<script src="../public/js/app.js"></script>

</body>
</html>